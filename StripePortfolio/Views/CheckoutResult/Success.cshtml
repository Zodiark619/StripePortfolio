<h2>Payment Successful!</h2>
<p>Your payment was processed correctly.</p>

<div id="orderSummary">Loading order details...</div>
<table id="cardsTable" class="display" style="width:100%">
    <thead>
        <tr>
            <th>Id</th>
            <th>Card Name</th>
            <th>Elements</th>
            <th>Rarity</th>
            <th>Subtype</th>
            <th>Cardtype</th>
            <th>Set</th> 
            <th>Quantity</th>
            <th>Image</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<script>
    const sessionId = new URLSearchParams(window.location.search).get('session_id');

    if (!sessionId) {
        document.getElementById("orderSummary").innerText = "No session ID found.";
    } else {
        fetch(`/api/checkout/by-session/${sessionId}`)
            .then(r => r.json())
            .then(data => showOrderSummary(data))
            .catch(err => {
                document.getElementById("orderSummary").innerText =
                    "Unable to load order details.";
            });
    }

       function showOrderSummary(data) {

           if (data.cards && data.cards.length > 0) {
        let table = $("#cardsTable").DataTable({
            data: data.cards,
            columns: [
                {data:'id'},
                { data: "name" },
                { data: "element" },
                { data: "rarity" },
                { data: "subtype" },
                { data: "cardtype" },
                { data: "set" }, 
                { data: "quantity" },
                {data:"imageurl",render:function(data,type,row){
                  if (!data) return "";
                        return `<img src="${data}" width="60" height="60" style="object-fit:contain;">`;
                }
                }
            ]
        });
    }











        let itemsHtml = "";

        data.items.forEach(item => {
            itemsHtml += `
                <li>
                    ${item.product.name}
                    (x${item.quantity}) —
                    $${(item.unitPrice * item.quantity / 100).toFixed(2)}
                </li>
            `;
        });

        document.getElementById("orderSummary").innerHTML = `
            <h3>Order Summary</h3>
            <ul>${itemsHtml}</ul>

            <p><strong>Total Amount:</strong>
                $${(data.amount / 100).toFixed(2)}
            </p>

            <p><strong>Status:</strong> ${data.status}</p>
            <p><strong>Created:</strong> ${new Date(data.createdAt).toLocaleString()}</p>
        `;
    }
</script>
